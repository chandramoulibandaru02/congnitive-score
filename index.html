import React, { useState, useEffect } from 'react';
import { User, Brain, CheckCircle, Circle, Bookmark, ChevronLeft, ChevronRight } from 'lucide-react';

// Question data (embedded as per your files)
const logicalQuestions = [
  {id: 1, type: "syllogism", difficulty: "easy", question: "All dogs are animals. All animals are living beings. Which conclusion is correct?", options: ["All dogs are living beings", "Some dogs are not animals", "No animals are dogs", "Some living beings are not animals"], answer: 0},
  {id: 2, type: "syllogism", difficulty: "easy-medium", question: "Some books are pens. All pens are pencils. Which conclusion follows?", options: ["All books are pencils", "Some books are pencils", "No books are pencils", "Some pencils are not books"], answer: 1},
  {id: 3, type: "syllogism", difficulty: "medium", question: "All engineers are graduates. Some graduates are teachers. Which conclusion is valid?", options: ["All engineers are teachers", "Some teachers are engineers", "Some engineers may be teachers", "No engineers are teachers"], answer: 2},
  {id: 4, type: "syllogism", difficulty: "medium-hard", question: "No fruits are vegetables. Some vegetables are carrots. Which conclusion follows?", options: ["Some carrots are fruits", "No carrots are fruits", "Some vegetables are not fruits", "All vegetables are fruits"], answer: 2},
  {id: 5, type: "odd-one-out", difficulty: "easy", question: "Find the odd one out.", options: ["Dog", "Cat", "Cow", "Car"], answer: 3},
  {id: 6, type: "odd-one-out", difficulty: "easy-medium", question: "Find the odd one out.", options: ["Circle", "Triangle", "Square", "Sphere"], answer: 3},
  {id: 7, type: "odd-one-out", difficulty: "medium", question: "Find the odd one out.", options: ["Addition", "Subtraction", "Multiplication", "Division"], answer: 3},
  {id: 8, type: "odd-one-out", difficulty: "medium", question: "Find the odd one out.", options: ["Pen", "Pencil", "Eraser", "Notebook"], answer: 3},
  {id: 9, type: "number-logic", difficulty: "easy", question: "Find the next number in the series: 2, 4, 6, 8, ?", options: ["9", "10", "11", "12"], answer: 1},
  {id: 10, type: "number-logic", difficulty: "easy-medium", question: "Find the missing number: 3, 9, 27, ?", options: ["54", "81", "72", "90"], answer: 1},
  {id: 11, type: "number-logic", difficulty: "medium", question: "Find the next number in the series: 1, 4, 9, 16, ?", options: ["20", "24", "25", "36"], answer: 2},
  {id: 12, type: "number-logic", difficulty: "medium-hard", question: "Find the missing number: 5, 10, 20, 40, ?", options: ["60", "70", "80", "100"], answer: 2},
  {id: 13, type: "statement-conclusion", difficulty: "easy", question: "Statement: All students in a class passed the exam. Conclusion: Some students in the class passed the exam. Choose the correct option.", options: ["Conclusion follows", "Conclusion does not follow", "Both statement and conclusion are false", "Statement is false"], answer: 0},
  {id: 14, type: "statement-conclusion", difficulty: "easy-medium", question: "Statement: Some fruits are sweet. Conclusion: All fruits are sweet. Choose the correct option.", options: ["Conclusion follows", "Conclusion does not follow", "Statement is false", "Both are true"], answer: 1},
  {id: 15, type: "statement-conclusion", difficulty: "medium", question: "Statement: All engineers are intelligent. Some intelligent people are creative. Conclusion: Some engineers may be creative. Choose the correct option.", options: ["Conclusion follows", "Conclusion does not follow", "Conclusion contradicts the statement", "Statement is incorrect"], answer: 0},
  {id: 16, type: "statement-conclusion", difficulty: "medium-hard", question: "Statement: No cars are bicycles. Some bicycles are electric. Conclusion: Some electric vehicles are not cars. Choose the correct option.", options: ["Conclusion follows", "Conclusion does not follow", "Statement is false", "Conclusion is opposite"], answer: 0},
  {id: 17, type: "deduction", difficulty: "easy", question: "Statement: It is raining heavily. What can be logically concluded?", options: ["People may use umbrellas", "It will not rain tomorrow", "The temperature will increase", "There will be no traffic"], answer: 0},
  {id: 18, type: "cause-effect", difficulty: "easy-medium", question: "Cause: A student did not prepare for the exam. What is the most likely effect?", options: ["The student may score poorly", "The exam will be cancelled", "The syllabus will change", "The student will top the class"], answer: 0},
  {id: 19, type: "deduction", difficulty: "medium", question: "Statement: All offices are closed today due to a strike. Ravi works in an office. What can be concluded?", options: ["Ravi is working from home", "Ravi's office is closed", "Ravi is on leave", "Ravi is unemployed"], answer: 1},
  {id: 20, type: "cause-effect", difficulty: "medium-hard", question: "Cause: A company increases product prices significantly. What is the most logical effect?", options: ["Customer demand may decrease", "Production will stop immediately", "Employees will resign instantly", "Profit will always increase"], answer: 0}
];

const patternQuestions = [
  {id: 1, type: "number-pattern", difficulty: "easy", question: "Find the next number in the series: 1, 3, 5, 7, ?", options: ["8", "9", "10", "11"], answer: 1},
  {id: 2, type: "number-pattern", difficulty: "easy-medium", question: "Find the missing number: 2, 6, 18, ?, 162", options: ["36", "48", "54", "72"], answer: 2},
  {id: 3, type: "number-pattern", difficulty: "medium", question: "Find the next number in the series: 4, 9, 16, 25, ?", options: ["30", "35", "36", "49"], answer: 2},
  {id: 4, type: "number-pattern", difficulty: "medium-hard", question: "Find the missing number: 1, 4, 9, 16, ?, 36", options: ["20", "24", "25", "30"], answer: 2},
  {id: 5, type: "alphabet-pattern", difficulty: "easy", question: "Find the next letter in the series: A, C, E, G, ?", options: ["H", "I", "J", "K"], answer: 1},
  {id: 6, type: "alphabet-pattern", difficulty: "easy-medium", question: "Find the missing letter: B, D, F, ?, J", options: ["G", "H", "I", "K"], answer: 2},
  {id: 7, type: "alphabet-pattern", difficulty: "medium", question: "Find the next letter in the series: Z, X, V, T, ?", options: ["S", "R", "Q", "P"], answer: 1},
  {id: 8, type: "alphabet-pattern", difficulty: "medium-hard", question: "Find the missing letter: A, D, H, M, ?", options: ["Q", "R", "S", "T"], answer: 1},
  {id: 9, type: "shape-pattern", difficulty: "easy", question: "Choose the shape that completes the pattern: ▲ ● ▲ ● ▲ ?", options: ["▲", "●", "■", "◆"], answer: 1},
  {id: 10, type: "shape-pattern", difficulty: "easy-medium", question: "Find the missing shape: ■ ■ ● ● ■ ■ ? ?", options: ["● ●", "■ ■", "● ■", "■ ●"], answer: 0},
  {id: 11, type: "shape-pattern", difficulty: "medium", question: "Choose the correct continuation: ▲ ■ ● ▲ ■ ● ▲ ■ ?", options: ["■", "▲", "●", "◆"], answer: 2},
  {id: 12, type: "shape-pattern", difficulty: "medium-hard", question: "Find the missing shape: ● ▲ ■ ● ■ ▲ ● ▲ ?", options: ["■", "▲", "●", "◆"], answer: 0},
  {id: 13, type: "missing-element", difficulty: "easy", question: "Find the missing number: 2, 4, ?, 8, 10", options: ["5", "6", "7", "9"], answer: 1},
  {id: 14, type: "missing-element", difficulty: "easy-medium", question: "Find the missing letter: A, C, ?, G, I", options: ["D", "E", "F", "H"], answer: 1},
  {id: 15, type: "missing-element", difficulty: "medium", question: "Find the missing number: 1, 4, 9, ?, 25", options: ["12", "14", "16", "18"], answer: 2},
  {id: 16, type: "missing-element", difficulty: "medium-hard", question: "Find the missing number: 2, 6, ?, 18, 54", options: ["8", "9", "12", "15"], answer: 2},
  {id: 17, type: "logic-pattern", difficulty: "easy", question: "Find the odd pattern logic: 2 → 4, 3 → 9, 4 → 16, 5 → ?", options: ["20", "25", "30", "15"], answer: 1},
  {id: 18, type: "logic-pattern", difficulty: "easy-medium", question: "Find the next value: A1, B4, C9, D16, ?", options: ["E20", "E25", "E16", "E36"], answer: 1},
  {id: 19, type: "logic-pattern", difficulty: "medium", question: "Find the missing term: 1, 1, 2, 3, 5, ?", options: ["6", "7", "8", "9"], answer: 2},
  {id: 20, type: "logic-pattern", difficulty: "medium-hard", question: "Find the next term: 2, 6, 12, 20, ?", options: ["24", "30", "36", "42"], answer: 1}
];

const memoryQuestions = [
  {id: 1, type: "word-recall", difficulty: "easy", question: "Remember these words: Apple, Chair, River, Doctor, Blue. Which word was THIRD?", options: ["Chair", "River", "Doctor", "Blue"], answer: 1},
  {id: 2, type: "word-recall", difficulty: "easy-medium", question: "Remember these words: Pen, Train, Tiger, Book, Phone. Which word was LAST?", options: ["Book", "Tiger", "Train", "Phone"], answer: 3},
  {id: 3, type: "word-recall", difficulty: "medium", question: "Remember these words: Sun, Tree, Clock, Milk, Road. Which word was SECOND?", options: ["Sun", "Tree", "Clock", "Milk"], answer: 1},
  {id: 4, type: "word-recall", difficulty: "medium-hard", question: "Remember these words: Laptop, Bottle, Mirror, Window, Shoe. Which word was FIRST?", options: ["Bottle", "Laptop", "Window", "Shoe"], answer: 1},
  {id: 5, type: "number-recall", difficulty: "easy", question: "Remember this number: 4827. What was the LAST digit?", options: ["4", "7", "2", "8"], answer: 1},
  {id: 6, type: "number-recall", difficulty: "easy-medium", question: "Remember this number: 91364. What was the FIRST digit?", options: ["9", "1", "6", "4"], answer: 0},
  {id: 7, type: "number-recall", difficulty: "medium", question: "Remember this number: 27519. Which digit was in the THIRD position?", options: ["5", "7", "1", "9"], answer: 0},
  {id: 8, type: "number-recall", difficulty: "medium-hard", question: "Remember this number: 804372. Which digit came just BEFORE 7?", options: ["3", "4", "0", "2"], answer: 1},
  {id: 9, type: "sequence-recall", difficulty: "easy", question: "Remember this sequence: Red, Blue, Green, Yellow. Which color came SECOND?", options: ["Red", "Blue", "Green", "Yellow"], answer: 1},
  {id: 10, type: "sequence-recall", difficulty: "easy-medium", question: "Remember this sequence: 5, 8, 2, 9, 4. Which number came LAST?", options: ["2", "8", "9", "4"], answer: 3},
  {id: 11, type: "sequence-recall", difficulty: "medium", question: "Remember this sequence: Dog, Cat, Cow, Horse, Sheep. Which animal came THIRD?", options: ["Cat", "Cow", "Horse", "Sheep"], answer: 1},
  {id: 12, type: "sequence-recall", difficulty: "medium-hard", question: "Remember this sequence: A, D, G, J, M. Which letter came just BEFORE J?", options: ["D", "G", "H", "M"], answer: 1},
  {id: 13, type: "visual-recall", difficulty: "easy", question: "Look at this text carefully: CAT – DOG – BIRD – FISH. Which word was written THIRD?", options: ["DOG", "BIRD", "FISH", "CAT"], answer: 1},
  {id: 14, type: "visual-recall", difficulty: "easy-medium", question: "Observe this pattern: ★ ● ★ ● ★. Which symbol came LAST?", options: ["●", "★", "■", "▲"], answer: 1},
  {id: 15, type: "visual-recall", difficulty: "medium", question: "Read carefully: RED, BLUE, GREEN, YELLOW. Which color was written FIRST?", options: ["BLUE", "GREEN", "RED", "YELLOW"], answer: 2},
  {id: 16, type: "visual-recall", difficulty: "medium-hard", question: "Observe this sequence: 7 2 9 4 6. Which number appeared just BEFORE 4?", options: ["9", "2", "6", "7"], answer: 0},
  {id: 17, type: "short-term-logic-recall", difficulty: "easy", question: "Remember this statement: All cats are animals. A cat named Tom exists. What can be logically recalled?", options: ["Tom is an animal", "Tom is a dog", "All animals are cats", "Tom does not exist"], answer: 0},
  {id: 18, type: "short-term-logic-recall", difficulty: "easy-medium", question: "Remember this information: Ramesh is taller than Suresh. Suresh is taller than Anil. Who is the shortest?", options: ["Ramesh", "Suresh", "Anil", "Cannot be determined"], answer: 2},
  {id: 19, type: "short-term-logic-recall", difficulty: "medium", question: "Remember this rule: If it rains, the ground becomes wet. It rained today. What can be concluded?", options: ["The ground is wet", "It will rain tomorrow", "The ground is dry", "There is no rain"], answer: 0},
  {id: 20, type: "short-term-logic-recall", difficulty: "medium-hard", question: "Remember this sequence of facts: All laptops are machines. Some machines are expensive. Which statement is logically correct?", options: ["All laptops are expensive", "Some laptops may be expensive", "No laptops are expensive", "Machines cannot be laptops"], answer: 1}
];

const problemQuestions = [
  {id: 1, type: "arithmetic", difficulty: "easy", question: "If a pen costs ₹10, how much will 5 pens cost?", options: ["₹40", "₹50", "₹60", "₹70"], answer: 1},
  {id: 2, type: "arithmetic", difficulty: "easy-medium", question: "A book costs ₹120. If you get a discount of ₹20, what is the final price?", options: ["₹80", "₹90", "₹100", "₹110"], answer: 2},
  {id: 3, type: "arithmetic", difficulty: "medium", question: "If the sum of two numbers is 30 and one number is 12, what is the other number?", options: ["18", "20", "22", "15"], answer: 0},
  {id: 4, type: "arithmetic", difficulty: "medium-hard", question: "A product costs ₹200. If its price increases by 10%, what is the new price?", options: ["₹210", "₹215", "₹220", "₹225"], answer: 2},
  {id: 5, type: "time-work", difficulty: "easy", question: "If one person can complete a task in 10 days, how many days will it take for two people working together?", options: ["10 days", "5 days", "20 days", "8 days"], answer: 1},
  {id: 6, type: "time-work", difficulty: "easy-medium", question: "A worker can finish a job in 12 days. How much work does he complete in 1 day?", options: ["1/6", "1/12", "1/10", "1/24"], answer: 1},
  {id: 7, type: "time-work", difficulty: "medium", question: "A can complete a work in 6 days and B can complete the same work in 12 days. How many days will they take together?", options: ["3 days", "4 days", "6 days", "8 days"], answer: 1},
  {id: 8, type: "time-work", difficulty: "medium-hard", question: "A person completes a work in 15 days. After working for 5 days, how many days are required to complete the remaining work?", options: ["8 days", "10 days", "12 days", "15 days"], answer: 1},
  {id: 9, type: "speed-distance", difficulty: "easy", question: "If a car travels at a speed of 40 km/h, how much distance will it cover in 2 hours?", options: ["60 km", "70 km", "80 km", "90 km"], answer: 2},
  {id: 10, type: "speed-distance", difficulty: "easy-medium", question: "A person walks at a speed of 5 km/h. How long will it take to cover 15 km?", options: ["2 hours", "3 hours", "4 hours", "5 hours"], answer: 1},
  {id: 11, type: "speed-distance", difficulty: "medium", question: "A train covers a distance of 120 km in 2 hours. What is its speed?", options: ["40 km/h", "50 km/h", "60 km/h", "70 km/h"], answer: 2},
  {id: 12, type: "speed-distance", difficulty: "medium-hard", question: "Two cars start from the same point. One moves at 60 km/h and the other at 40 km/h. What is the distance between them after 2 hours?", options: ["20 km", "30 km", "40 km", "50 km"], answer: 2},
  {id: 13, type: "logical-situation", difficulty: "easy", question: "A shop opens at 9 AM and closes at 9 PM. For how many hours is the shop open in a day?", options: ["10 hours", "11 hours", "12 hours", "13 hours"], answer: 2},
  {id: 14, type: "logical-situation", difficulty: "easy-medium", question: "If today is Monday, what day will it be after 10 days?", options: ["Wednesday", "Thursday", "Friday", "Saturday"], answer: 2},
  {id: 15, type: "logical-situation", difficulty: "medium", question: "There are 3 boxes. One contains apples, one contains oranges, and one contains both. All boxes are wrongly labeled. Which box should be opened to identify all boxes?", options: ["Box labeled Apples", "Box labeled Oranges", "Box labeled Apples & Oranges", "Any box"], answer: 2},
  {id: 16, type: "logical-situation", difficulty: "medium-hard", question: "In a class, 60% of students like Maths and 40% like Science. If every student likes at least one subject, what percentage like both?", options: ["0%", "10%", "20%", "30%"], answer: 2},
  {id: 17, type: "real-life-decision", difficulty: "easy", question: "You have ₹500 and want to buy a book costing ₹450. What is the best decision?", options: ["Buy the book", "Do not buy the book", "Borrow money unnecessarily", "Ignore the price"], answer: 0},
  {id: 18, type: "real-life-decision", difficulty: "easy-medium", question: "You have an exam tomorrow and a party tonight. What is the most logical decision?", options: ["Go to the party all night", "Study first, then rest", "Skip the exam", "Ignore both"], answer: 1},
  {id: 19, type: "real-life-decision", difficulty: "medium", question: "You are running late for class but see someone injured on the road. What should you do?", options: ["Ignore and go to class", "Help the injured person or seek help", "Take a photo and leave", "Wait and do nothing"], answer: 1},
  {id: 20, type: "real-life-decision", difficulty: "medium-hard", question: "Your phone battery is low and you need it for an important call later. What is the best action?", options: ["Watch videos now", "Turn on battery saver and limit usage", "Play games continuously", "Switch off the phone permanently"], answer: 1}
];

function CognitiveAssessment() {
  const [page, setPage] = useState('user-details');
  const [userData, setUserData] = useState({ name: '', age: '', education: '' });
  const [testQuestions, setTestQuestions] = useState([]);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [answers, setAnswers] = useState({});
  const [visited, setVisited] = useState(new Set([0]));
  const [bookmarked, setBookmarked] = useState(new Set());
  const [results, setResults] = useState(null);

  const shuffleArray = (array) => {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  };

  const selectRandomQuestions = (questions, count) => {
    const shuffled = shuffleArray(questions);
    return shuffled.slice(0, count);
  };

  const startTest = () => {
    if (!userData.name || !userData.age || !userData.education) {
      alert('Please fill in all fields');
      return;
    }

    const selected = [
      ...selectRandomQuestions(logicalQuestions, 5).map((q, i) => ({ ...q, section: 'Logical Reasoning', globalId: i })),
      ...selectRandomQuestions(patternQuestions, 5).map((q, i) => ({ ...q, section: 'Pattern Recognition', globalId: i + 5 })),
      ...selectRandomQuestions(memoryQuestions, 5).map((q, i) => ({ ...q, section: 'Memory', globalId: i + 10 })),
      ...selectRandomQuestions(problemQuestions, 5).map((q, i) => ({ ...q, section: 'Problem Solving', globalId: i + 15 }))
    ];

    setTestQuestions(selected);
    setPage('test');
  };

  const handleAnswer = (optionIndex) => {
    setAnswers({ ...answers, [currentQuestion]: optionIndex });
  };

  const navigateToQuestion = (index) => {
    setCurrentQuestion(index);
    setVisited(new Set([...visited, index]));
  };

  const toggleBookmark = () => {
    const newBookmarks = new Set(bookmarked);
    if (newBookmarks.has(currentQuestion)) {
      newBookmarks.delete(currentQuestion);
    } else {
      newBookmarks.add(currentQuestion);
    }
    setBookmarked(newBookmarks);
  };

  const submitTest = () => {
    const sectionScores = {
      'Logical Reasoning': { correct: 0, total: 5 },
      'Pattern Recognition': { correct: 0, total: 5 },
      'Memory': { correct: 0, total: 5 },
      'Problem Solving': { correct: 0, total: 5 }
    };

    testQuestions.forEach((q, idx) => {
      if (answers[idx] === q.answer) {
        sectionScores[q.section].correct++;
      }
    });

    const sectionPercentages = {};
    Object.keys(sectionScores).forEach(section => {
      sectionPercentages[section] = (sectionScores[section].correct / sectionScores[section].total) * 100;
    });

    const overallScore = Object.values(sectionPercentages).reduce((a, b) => a + b, 0) / 4;

    setResults({ sectionScores: sectionPercentages, overallScore });
    setPage('result');
  };

  const getQuestionStatus = (index) => {
    if (bookmarked.has(index)) return 'bookmarked';
    if (answers[index] !== undefined) return 'answered';
    if (visited.has(index)) return 'visited';
    return 'not-visited';
  };

  if (page === 'user-details') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
          <div className="flex items-center justify-center mb-6">
            <Brain className="w-12 h-12 text-indigo-600 mr-3" />
            <h1 className="text-3xl font-bold text-gray-800">Cognitive Assessment</h1>
          </div>
          <p className="text-gray-600 text-center mb-8">Enter your details to begin the test</p>
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
              <input
                type="text"
                value={userData.name}
                onChange={(e) => setUserData({ ...userData, name: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="Enter your name"
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Age</label>
              <input
                type="number"
                value={userData.age}
                onChange={(e) => setUserData({ ...userData, age: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="Enter your age"
              />
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">Education Level</label>
              <select
                value={userData.education}
                onChange={(e) => setUserData({ ...userData, education: e.target.value })}
                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
              >
                <option value="">Select education level</option>
                <option value="High School">High School</option>
                <option value="Undergraduate">Undergraduate</option>
                <option value="Graduate">Graduate</option>
                <option value="Postgraduate">Postgraduate</option>
              </select>
            </div>
          </div>
          
          <button
            onClick={startTest}
            className="w-full mt-6 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
          >
            Start Test
          </button>
        </div>
      </div>
    );
  }

  if (page === 'test') {
    const currentQ = testQuestions[currentQuestion];
    
    return (
      <div className="min-h-screen bg-gray-50 p-4">
        <div className="max-w-7xl mx-auto">
          <div className="bg-white rounded-lg shadow-lg p-4 mb-4">
            <div className="flex justify-between items-center">
              <h2 className="text-2xl font-bold text-gray-800">Cognitive Assessment Test</h2>
              <span className="text-sm text-gray-600">Welcome, {userData.name}</span>
            </div>
          </div>
          
          <div className="grid grid-cols-1 lg:grid-cols-4 gap-4">
            <div className="lg:col-span-1 bg-white rounded-lg shadow-lg p-4">
              <h3 className="font-semibold text-gray-700 mb-4">Question Navigation</h3>
              <div className="grid grid-cols-5 gap-2">
                {testQuestions.map((_, idx) => {
                  const status = getQuestionStatus(idx);
                  let bgColor = 'bg-gray-200';
                  if (status === 'answered') bgColor = 'bg-green-500 text-white';
                  else if (status === 'bookmarked') bgColor = 'bg-yellow-400';
                  else if (status === 'visited') bgColor = 'bg-blue-300';
                  
                  return (
                    <button
                      key={idx}
                      onClick={() => navigateToQuestion(idx)}
                      className={`${bgColor} ${idx === currentQuestion ? 'ring-2 ring-indigo-600' : ''} w-10 h-10 rounded-lg font-semibold hover:opacity-80 transition-opacity`}
                    >
                      {idx + 1}
                    </button>
                  );
                })}
              </div>
              
              <div className="mt-6 space-y-2 text-sm">
                <div className="flex items-center">
                  <div className="w-4 h-4 bg-gray-200 rounded mr-2"></div>
                  <span>Not Visited</span>
                </div>
                <div className="flex items-center">
                  <div className="w-4 h-4 bg-blue-300 rounded mr-2"></div>
                  <span>Visited</span>
                </div>
                <div className="flex items-center">
                  <div className="w-4 h-4 bg-green-500 rounded mr-2"></div>
                  <span>Answered</span>
                </div>
                <div className="flex items-center">
                  <div className="w-4 h-4 bg-yellow-400 rounded mr-2"></div>
                  <span>Bookmarked</span>
                </div>
              </div>
            </div>
            
            <div className="lg:col-span-3 bg-white rounded-lg shadow-lg p-6">
              <div className="mb-4">
                <span className="text-sm text-gray-500">Section: {currentQ.section}</span>
                <h3 className="text-lg font-semibold text-gray-800 mt-1">Question {currentQuestion + 1} of 20</h3>
              </div>
              
              <p className="text-gray-800 text-lg mb-6">{currentQ.question}</p>
              
              <div className="space-y-3 mb-8">
                {currentQ.options.map((option, idx) => (
                  <button
                    key={idx}
                    onClick={() => handleAnswer(idx)}
                    className={`w-full text-left p-4 rounded-lg border-2 transition-colors ${
                      answers[currentQuestion] === idx
                        ? 'border-indigo-600 bg-indigo-50'
                        : 'border-gray-300 hover:border-indigo-400'
                    }`}
                  >
                    <span className="font-semibold mr-2">{String.fromCharCode(65 + idx)}.</span>
                    {option}
                  </button>
                ))}
              </div>
              
              <div className="flex justify-between items-center pt-4 border-t">
                <button
                  onClick={() => navigateToQuestion(Math.max(0, currentQuestion - 1))}
                  disabled={currentQuestion === 0}
                  className="flex items-center px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <ChevronLeft className="w-4 h-4 mr-1" />
                  Previous
                </button>
                
                <button
                  onClick={toggleBookmark}
                  className={`flex items-center px-4 py-2 rounded-lg ${
                    bookmarked.has(currentQuestion)
                      ? 'bg-yellow-400 hover:bg-yellow-500'
                      : 'bg-gray-200 hover:bg-gray-300'
                  }`}
                >
                  <Bookmark className="w-4 h-4 mr-1" />
                  {bookmarked.has(currentQuestion) ? 'Bookmarked' : 'Bookmark'}
                </button>
                
                {currentQuestion < 19 ? (
                  <button
                    onClick={() => navigateToQuestion(currentQuestion + 1)}
                    className="flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
                  >
                    Next
                    <ChevronRight className="w-4 h-4 ml-1" />
                  </button>
                ) : (
                  <button
                    onClick={submitTest}
                    className="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
                  >
                    <CheckCircle className="w-4 h-4 mr-1" />
                    Submit Test
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (page === 'result') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-100 flex items-center justify-center p-4">
        <div className="bg-white rounded-xl shadow-2xl p-8 max-w-2xl w-full">
          <div className="text-center mb-8">
            <CheckCircle className="w-16 h-16 text-green-600 mx-auto mb-4" />
            <h1 className="text-3xl font-bold text-gray-800 mb-2">Test Completed!</h1>
            <p className="text-gray-600">Congratulations, {userData.name}</p>
          </div>
          
          <div className="bg-indigo-50 rounded-lg p-6 mb-6">
            <h2 className="text-xl font-semibold text-center text-gray-800 mb-2">Overall Cognitive Score</h2>
            <p className="text-5xl font-bold text-center text-indigo-600">{results.overallScore.toFixed(1)}%</p>
          </div>
          
          <div className="space-y-4">
            <h3 className="font-semibold text-gray-800 mb-3">Section-wise Performance</h3>
            {Object.entries(results.sectionScores).map(([section, score]) => (
              <div key={section} className="bg-gray-50 rounded-lg p-4">
                <div className="flex justify-between items-center mb-2">
                  <span className="font-medium text-gray-700">{section}</span>
                  <span className="font-bold text-indigo-600">{score.toFixed(0)}%</span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div
                    className="bg-indigo-600 h-2 rounded-full"
                    style={{ width: `${score}%` }}
                  ></div>
                </div>
              </div>
            ))}
          </div>
          
          <button
            onClick={() => {
              setPage('user-details');
              setUserData({ name: '', age: '', education: '' });
              setTestQuestions([]);
              setCurrentQuestion(0);
              setAnswers({});
              setVisited(new Set([0]));
              setBookmarked(new Set());
              setResults(null);
            }}
            className="w-full mt-8 bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
          >
            Take Another Test
          </button>
        </div>
      </div>
    );
  }

  return null;
}

export default CognitiveAssessment;
